#!/usr/bin/env python3\n# -*- coding: utf-8 -*-\nimport re, html, os, datetime\nBIB=os.path.join(os.path.dirname(__file__),'..','publications.bib')\nOUT=os.path.join(os.path.dirname(__file__),'..','publications.html')\nENTRY_RE=re.compile(r'@(\\w+)\\s*\\{\\s*([^,]+),([\\s\\S]*?)\\}\\s*',re.MULTILINE)\nFIELD_RE=re.compile(r'(\\w+)\\s*=\\s*\\{([\\s\\S]*?)\\}\\s*,?',re.MULTILINE)\n\ndef parse_bib(t):\n    es=[]\n    for m in ENTRY_RE.finditer(t):\n        etype,key,body=m.groups()\n        fs={}\n        for f in FIELD_RE.finditer(body):\n            k,v=f.groups(); fs[k.lower()]=v.strip()\n        es.append((etype.lower(),key.strip(),fs))\n    return es\n\ndef fmt(e):\n    etype,key,f=e\n    title=html.escape(f.get('title','(sin título)'))\n    authors=html.escape(f.get('author','')).replace(' and ', ', ')\n    year=html.escape(f.get('year',''))\n    where=f.get('journal') or f.get('booktitle') or ''\n    where=html.escape(where)\n    doi=html.escape(f.get('doi',''))\n    parts=[f'<strong>{title}</strong>']\n    meta=[]\n    if authors: meta.append(authors)\n    if year: meta.append(year)\n    if where: meta.append(where)\n    if doi: meta.append(f"DOI: <a href='https://doi.org/{doi}' target='_blank' rel='noopener'>{doi}</a>")\n    return f"<li>{' — '.join(parts)}<br><span class='meta'>{' · '.join(meta)}</span></li>"\n\ndef main():\n    if not os.path.exists(BIB):\n        raise SystemExit('No existe publications.bib')\n    with open(BIB,'r',encoding='utf-8') as f: text=f.read()\n    es=parse_bib(text)\n    def yr(e):\n        try: return int(e[2].get('year','0'))\n        except: return 0\n    es.sort(key=yr, reverse=True)\n    items='\n'.join(fmt(e) for e in es)\n    html_out=("<!doctype html><html lang='es'><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'><title>Publicaciones — Laboratorio IA y DS</title><link rel='stylesheet' href='styles.css'><style>.pubs{max-width:900px;margin:40px auto;padding:0 20px}.pubs h1{margin-bottom:12px} .pubs ul{line-height:1.7}.meta{color:var(--muted)} a{color:var(--blue);text-decoration:none}</style></head><body><div class='pubs'><a href='index.html' class='btn ghost'>← Volver</a><h1>Publicaciones</h1><ul>"+items+"</ul><p class='note'>Generado el "+datetime.date.today().isoformat()+" desde <code>publications.bib</code>.</p></div></body></html>")\n    with open(OUT,'w',encoding='utf-8') as f: f.write(html_out)\n    print('Generado:', OUT)\n\nif __name__=='__main__':\n    main()\n